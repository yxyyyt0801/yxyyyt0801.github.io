# 功能

## 后台管理

### 账户登陆

#### 登陆

- 展示【验证码】，关联uuid缓存到redis

  - 设置缓存时间

  - 每一次请求都会新生成验证码，同时在redis缓存，考虑频繁刷新页面导致redis压力问题

- 输入【用户名】、【密码】、【验证码】、uuid

- 校验验证码、密码、账户状态（1）、商户状态（A）、店铺状态（A）
  - 商户和店铺id为0时，属于超级管理员，没有实体商户和店铺，不需要校验

- 生成token，同时将账户信息缓存到redis

- 输出token
  - 注意token有效期的问题



#### 登出

- 移除token账户信息redis缓存



### 系统首页

- 获取账户、角色、菜单信息

- 为账户生产动态菜单路由

- 获取首页数据

  - 总会员数、今日新增会员数量
    - STATUS != 'D' and IS_STAFF = 'N'

  - 总订单数、今日订单数
    - STATUS not in('C', 'G', 'H')

  - 总交易金额、今日交易金额
    - STATUS not in('C', 'G', 'H')

  - 今日活跃会员数
    - STATUS='A'

  - 总支付人数
    - PAY_STATUS='B' and t.STATUS not in('C', 'G', 'H')

- 分别获取7日内统计数据（包括今日）
  - 订单数和活跃会员数



### 店铺管理

#### 商户管理

- 查询【商户号】、【商户名称】、【状态】分页查询 “商户” 列表

- 更新商户状态

  - 启用 STATUS='A'

  - 禁用 STATUS='N'

  - 删除 STATUS='D'

- 后台账号

- 新建商户

  - 名称不能重复

  - 非超级管理员（商户 id为0）不能新建商户

  - 上传商户 logo



#### 店铺列表

- 查询【店铺名称】、【状态】分页查询 “店铺” 列表

- 更新商户状态

  - 启用 STATUS='A'

  - 禁用 STATUS='N'

  - 删除 STATUS='D'

- 后台账号

- 二维码

- 新建店铺

  - 访问==高德地图api==获取地址的经纬度

  - 名称不能重复

  - 非超级管理员（店铺 id为0）不能新建店铺

  - 上传商户 logo、营业执照、微信支付证书
    - 对上传文件加入验证，以及审核机制
    - 定期清除无用图片



#### 员工管理

- 查询【员工类别】、【姓名】、【手机号】、【状态】分页查询 “员工” 列表

- 更新员工状态，发送短信通知

  - 启用 STATUS='A'

  - 禁用 STATUS='N'

  - 删除 STATUS='D'

后台账号

- 新建员工

  - 超级管理员（商户 id为0）不能新建员工

  - 手机号码不能重复

  - 自动关联创建会员
    - 创建会员
    - 开卡赠礼
    - ==发送短信api==



#### 桌码管理

- 查询【桌码】、【状态】分页查询 “桌码” 列表

- 更新员工状态，发送短信通知

  - 启用 STATUS='A'

  - 禁用 STATUS='N'

  - 删除 STATUS='D'

- 二维码

- 新建桌码

  - 超级管理员（商户 id为0）不能新建桌码

  - 桌码不能重复



#### 打印设备

- 查询【设备名称】、【编号】、【所属店铺】、【状态】分页查询 “打印设备” 列表

- 新增云打印设备

  - 必须优先设置==芯烨账号，会调用xpyun的API==

  - 超级管理员（商户 id为0）不能新建打印设备



#### 预约管理

- 查询【预约项目名称】、【预约类别】、【状态】分页查询 “预约项目” 列表

- 新增预约分类

- 新增预约项目
  - 属于某一预约分类的预约项目



#### 预约记录

- 查询【会员ID】、【预约分类】、【联系人】、【手机号】、【状态】分页查询 “预约记录” 列表

- 操作，更新状态

  - A（待审核） -> B（确认） | C（取消）| D（删除）

  - B（审核通过） -> E（完成）| D（删除）

  - E（已完成）->  D（删除）

  - C（已取消）->  D（删除）



### 内容管理

#### 轮播管理

- 查询【标题】、【所属店铺】、【状态】分页查询 “轮播” 列表



#### 文章管理

- 查询【文章标题】、【f状态】分页查询 “文章” 列表



### 会员管理

#### 会员列表

- 查询【会员ID】、【会员号】、【手机号】、【名称】、【会员等级】、【会员分组】、【状态】、【注册时间】、【所属店铺】分页查询 “会员” 列表

- 新增

  - 创建会员
  - 开卡赠礼
  - ==发送短信api==
  - 此时没有密码

- 重置密码

- 导入会员

  - 上传excel模版

- 下载导入模板

- 充值（余额）

  - 更新用户表余额
  - 新建余额
  - 新建充值订单
  - ==发送短信api==
  - ==发送小程序订阅消息api==

- 变更（积分）

  - 更新用户表积分

  - 新建积分

  - ==发送短信api==

  - ==发送小程序订阅消息api==

- 修改状态



#### 会员分组

- 查询【分组ID】、【分组名称】、【状态】分页查询 “会员分组” 列表

- 新增

- 添加子级
  - 会员分组的父子关系（会员只可以属于某一子级分组，不可属于父级）



#### 会员等级（升级条件）

- 查询【等级名称】、【升级方式】、【状态】分页查询 “会员等级” 列表
  - 升级方式：默认获取、付费升级、累计消费次数升级、累计消费金额升级
  - 有效天数：0 永久有效
- 新增、修改
- 修改状态



#### 开卡赠礼（升级后赠送的卡券和积分）

- 查询【卡券ID】、【会员等级】、【状态】分页查询 “开卡赠礼” 列表
- 新增、修改
- 修改状态



#### 会员设置

- 设置user参数：getCouponNeedPhone、submitOrderNeedPhone、loginNeedPhone、openWxCard
  - 当openWxCard时true时，参数wxMemberCard是微信会员卡参数，访问==微信api创建微信会员卡==，wxMemberCardId是微信会员卡ID



### 卡券管理

#### 分组管理

- 查询【分组ID】、【分组名称】、【状态】分页查询 “卡券分组” 列表
- 新增、修改



#### 卡券列表

- 查询【卡券ID】、【分组ID】、【名称】、【类型】、【状态】分页查询 “卡券” 列表

- 新增、修改

  - 卡券类型
    - 优惠券
    - 储值卡
    - 计次卡

- 发券

  - 发放对象
    - 部分会员
    - 全部会员
  - 新建用户卡券表关联记录
  - 新建发放记录，按一定规则，发到mt_user_coupon表，即表示一个用户的一张卡券实体
  - 在mt_send_log插入发送卡券日志
  - ==发送短信api==

  - ==发送小程序订阅消息api==

- 二维码



#### 卡券核销

- 确定核销
  - 通过mt_user_coupon表的code字段查找发放给某一个用户的卡券
    - 确定核销
      - 设置mt_user_coupon表的卡券实体记录
        - 优惠券 更新status已使用B
        - 储值卡 修改balance金额，当为0时，更新status已使用B
        - 计次卡 通过mt_confirm_log过去核销次数，当次数为0时，更新status已使用B
      - 插入mt_confirm_log核销记录日志
      - ==发送短信api==
      - ==发送小程序订阅消息api==
    - 取消
- 返回列表，进入会员卡券页面



#### 会员卡券



#### 核销流水



#### 发券记录



#### 转赠记录





### 订单管理

#### 订单列表



#### 售后订单



#### 交易设置



#### 订单结算



### 商品管理

#### 商品分类



#### 商品列表



#### 库存管理



### 消息管理



```
/**
 * Created by Rain on 2025/9/7<br>
 * All Rights Reserved(C) 2017 - 2025 SCIATTA <br> <p/>
 * 
 */
```



### 积分管理

### 充值管理

### 数据统计

### 分佣提成

### 系统管理



